<!doctype html>
<html lang="en" {% if current_user.is_authenticated and current_user.dark_mode %}class="dark-mode"{% endif %}>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Project Optimist News - Your Daily Dose of Positivity</title>
    <meta name="description" content="Project Optimist News aggregates positive and uplifting news stories from around the world, filtering out negativity to bring you a brighter perspective.">
    <meta name="keywords" content="positive news, good news, uplifting stories, world news, technology, science, culture, lifestyle, positive aggregation">

    <!-- Fonts & CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" crossorigin="anonymous">

    <style>
        /* New styles for user interface elements */
        .user-menu {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            align-items: center;
        }

        .user-button {
            display: flex;
            align-items: center;
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: #333;
        }

        .user-button:hover {
            background-color: #f5f5f5;
        }

        .user-button i {
            margin-right: 0.5rem;
            color: #e76f51;
        }

        .user-dropdown {
            position: absolute;
            right: 0;
            top: 100%;
            margin-top: 0.5rem;
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 100;
            min-width: 180px;
            display: none;
        }

        .user-dropdown.active {
            display: block;
        }

        .user-dropdown a {
            display: block;
            padding: 0.75rem 1rem;
            color: #333;
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .user-dropdown a:hover {
            background-color: #f5f5f5;
        }

        .user-dropdown a i {
            margin-right: 0.5rem;
            width: 16px;
            text-align: center;
            color: #e76f51;
        }

        .user-dropdown .divider {
            height: 1px;
            background-color: #e0e0e0;
            margin: 0.5rem 0;
        }

        /* Last updated indicator */
        .last-updated {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
        }

        .last-updated i {
            margin-right: 0.5rem;
            color: #e76f51;
        }

        /* Inspiration indicator */
        .inspiration-badge {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 5;
        }

        .inspiration-badge.small {
            width: 24px;
            height: 24px;
            font-size: 1rem;
            top: 0.5rem;
            right: 0.5rem;
        }

        .inspiration-badge.truly-inspiring {
            background-color: #ffd700; /* Gold background for truly inspiring content */
        }

        .inspiration-dimensions {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 0.75rem;
            z-index: 10;
            width: 220px;
        }

        .inspiration-badge:hover + .inspiration-dimensions {
            display: block;
        }

        .dimension-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .dimension-name {
            font-weight: 600;
        }

        .dimension-score {
            font-weight: 400;
            color: #666;
        }

        /* Save article button */
        .save-button {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 1.25rem;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            margin-left: auto;
        }

        .save-button:hover {
            color: #e76f51;
        }

        .save-button.saved {
            color: #e76f51;
        }

        /* Article share tools */
        .article-actions {
            display: flex;
            align-items: center;
            margin-top: 0.5rem;
        }

        .share-buttons {
            display: flex;
            align-items: center;
        }

        .share-buttons a {
            color: #999;
            font-size: 1rem;
            margin-right: 0.75rem;
            transition: color 0.2s;
        }

        .share-buttons a:hover {
            color: #e76f51;
        }

        /* Alerts */
        .alert {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 8px;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Dark mode */
        .dark-mode body {
            background-color: #222;
            color: #eee;
        }

        .dark-mode .filter-sidebar,
        .dark-mode .article-top,
        .dark-mode .article-flat {
            background-color: #333;
            color: #eee;
        }

        .dark-mode .article-top-content h3 a,
        .dark-mode .article-content h3 a {
            color: #eee;
        }

        .dark-mode .filter-item {
            color: #ddd;
        }

        .dark-mode .filter-item:hover,
        .dark-mode .filter-item.active {
            background-color: #444;
        }

        .dark-mode .user-button,
        .dark-mode .user-dropdown,
        .dark-mode .inspiration-badge,
        .dark-mode .inspiration-dimensions {
            background-color: #333;
            color: #eee;
            border-color: #444;
        }

        .dark-mode .user-button:hover,
        .dark-mode .user-dropdown a:hover {
            background-color: #444;
        }

        .dark-mode .user-dropdown .divider {
            background-color: #444;
        }
    </style>
</head>

<body>
    <header>
        <h1><a href="/">Project Optimist</a></h1>
        <p>Your daily dose of positivity</p>

        <!-- User menu -->
        <div class="user-menu">
            {% if current_user.is_authenticated %}
                <div class="user-button" id="user-menu-button">
                    <i class="fas fa-user-circle"></i>
                    <span>{{ current_user.username }}</span>
                </div>
                <div class="user-dropdown" id="user-dropdown">
                    <a href="{{ url_for('auth.profile') }}"><i class="fas fa-cog"></i> Profile Settings</a>
                    <a href="{{ url_for('auth.saved_articles') }}"><i class="fas fa-bookmark"></i> Saved Articles</a>
                    <div class="divider"></div>
                    <a href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt"></i> Log Out</a>
                </div>
                {% else %}
            <div class="auth-buttons">
                <a href="{{ url_for('auth.login') }}" class="user-button">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Log In</span>
                </a>
                <a href="{{ url_for('auth.signup') }}" class="user-button" style="margin-left: 10px;">
                    <i class="fas fa-user-plus"></i>
                    <span>Sign Up</span>
                </a>
            </div>
        {% endif %}
        </div>
    </header>

    <div class="layout-container">
        <!-- FILTER SIDEBAR -->
        <aside class="filter-sidebar">
            <div class="sidebar-section">
                <h3>Categories</h3>
                <ul class="filter-list">
                    <li><a href="/" class="filter-item {% if not selected_topic %}active{% endif %}">All News</a></li>
                    {% for topic in topics %}
                        <li>
                            <a href="/?topic={{ topic }}" class="filter-item {% if selected_topic == topic %}active{% endif %}">
                                {% if topic_icons.get(topic) %}
                                    <img src="{{ url_for('static', filename=topic_icons.get(topic)) }}" alt="icon" class="filter-icon">
                                {% endif %}
                                {{ topic|title }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Last updated information -->
            <div class="sidebar-section">
                <div class="last-updated">
                    <i class="fas fa-sync-alt"></i>
                    <span>Last updated: {{ last_updated|format_datetime if last_updated else 'Just now' }}</span>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>About</h3>
                <p class="sidebar-info">Project Optimist brings you positivity from around the world, using AI to find and rank the most inspiring stories.</p>
                <div class="inspiration-scale">
                    <div class="scale-label">Inspiration Scale:</div>
                    <div class="scale-item">üòÄ High</div>
                    <div class="scale-item">üôÇ Medium</div>
                    <div class="scale-item">üòê Low</div>
                </div>
                <div class="scale-item" style="margin-top: 0.5rem;">
                    <span style="background-color: #ffd700; padding: 0 4px; border-radius: 4px;">‚ú®</span> Truly Inspirational
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            {% if articles %}
                <!-- Top Stories Section -->
                <div class="content-header">
                    <h2>üî• Top Stories</h2>
                </div>
                <div class="top-stories-container">
                    {% set top_stories = articles[:4] %}
                    {% for article in top_stories %}
                        {% set inspiration = article.get('inspiration_score', 5) %}
                        {% set is_truly_inspiring = article.get('is_inspirational', False) %}
                        {% set inspiration_dimensions = article.get('inspiration_dimensions', {}) %}

                        <article id="article-top-{{ loop.index0 }}" class="article-top">
                            <!-- Content area with inspiration badge -->
                            <div class="article-top-content">
                                <!-- Inspiration badge -->
                                <div class="inspiration-badge {% if is_truly_inspiring %}truly-inspiring{% endif %}">
                                    {% if is_truly_inspiring %}
                                       üòÄ
                                    {% elif inspiration >= 8 %}
                                        üòÄ
                                    {% elif inspiration >= 5 %}
                                        üôÇ
                                    {% else %}
                                        üòê
                                    {% endif %}
                                </div>

                                <!-- Inspiration dimensions popup -->
                                <div class="inspiration-dimensions">
                                    <div class="dimension-item">
                                        <span class="dimension-name">Overall Score:</span>
                                        <span class="dimension-score">{{ inspiration }}/10</span>
                                    </div>
                                    {% if inspiration_dimensions %}
                                        {% for dim, score in inspiration_dimensions.items() %}
                                            {% if dim != 'composite' %}
                                                <div class="dimension-item">
                                                    <span class="dimension-name">{{ dim|title }}:</span>
                                                    <span class="dimension-score">{{ score }}/10</span>
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                </div>

                                <!-- Source info -->
                                <div class="article-source">
                                    <a href="{{ article['link'] }}" class="source-url-chip" target="_blank">
                                        {{ article['source_name'] }}
                                    </a>
                                    <div class="tag-container">
                                        {% if article.get('topic_name') %}
                                            <span class="topic-tag {{ article.get('topic_name')|title }}">
                                                {% if article.get('topic_icon_path') %}
                                                    <img src="{{ url_for('static', filename=article['topic_icon_path']) }}" alt="topic" class="emoji-icon">
                                                {% endif %}
                                                {{ article.get('topic_name')|title }}
                                            </span>
                                        {% endif %}

                                        <!-- Location tag - only shown if location is available -->
                                        {% if article.get('location') %}
                                            <span class="location-tag">
                                                <i class="fas fa-map-marker-alt"></i>
                                                {{ article.get('location') }}
                                            </span>
                                        {% endif %}
                                    </div>
                                </div>

                                <!-- Title with topic icon and summary -->
                                <h3>
                                    <a href="{{ article['link'] }}" target="_blank">
                                        {% if article.get('topic_icon_path') %}
                                            <span class="title-icon" style="background-image: url('{{ url_for('static', filename=article['topic_icon_path']) }}');"></span>
                                        {% endif %}
                                        {{ article['title'] }}
                                    </a>
                                </h3>
                                <p class="summary">{{ article['summary'] | striptags | truncate(100) }}</p>

                                <!-- Date and actions -->
                                <div class="article-actions">
                                    <small class="published">{{ article['published'] | format_datetime }}</small>

                                    <div class="share-buttons">
                                        <a href="https://twitter.com/intent/tweet?url={{ article['link'] | urlencode }}&text={{ article['title'] | urlencode }}" target="_blank" title="Share on Twitter">
                                            <i class="fab fa-twitter"></i>
                                        </a>
                                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ article['link'] | urlencode }}" target="_blank" title="Share on Facebook">
                                            <i class="fab fa-facebook-f"></i>
                                        </a>
                                    </div>

                                    {% if current_user.is_authenticated %}
                                        <form action="{{ url_for('auth.save_article') }}" method="post" style="margin: 0; display: contents;">
                                            <input type="hidden" name="article_link" value="{{ article['link'] }}">
                                            <input type="hidden" name="article_title" value="{{ article['title'] }}">
                                            <input type="hidden" name="topic_name" value="{{ article.get('topic_name', '') }}">
                                            <button type="submit" class="save-button" title="Save Article">
                                                <i class="fas fa-bookmark"></i>
                                            </button>
                                        </form>
                                    {% endif %}
                                </div>
                            </div>
                        </article>
                    {% endfor %}
                </div>

                <!-- Remaining Articles Section -->
                <div class="content-header">
                    <h2>More Positive News</h2>
                </div>
                {% for article in articles[4:] %}
                    {% set inspiration = article.get('inspiration_score', 5) %}
                    {% set is_truly_inspiring = article.get('is_inspirational', False) %}
                    {% set inspiration_dimensions = article.get('inspiration_dimensions', {}) %}

                    <article id="article-{{ loop.index0 }}" class="article-flat">
                        {% if article.get('image_url') %}
                            <div class="thumbnail-container {{ article.get('topic_name', 'general')|lower }}">
                                <img src="{{ article['image_url'] }}" alt="Thumbnail" class="thumbnail">
                                <div class="inspiration-badge small {% if is_truly_inspiring %}truly-inspiring{% endif %}">
                                    {% if is_truly_inspiring %}
                                        üòÄ
                                    {% elif inspiration >= 8 %}
                                        üòÄ
                                    {% elif inspiration >= 5 %}
                                        üôÇ
                                    {% else %}
                                        üòê
                                    {% endif %}
                                </div>

                                <!-- Inspiration dimensions popup -->
                                <div class="inspiration-dimensions">
                                    <div class="dimension-item">
                                        <span class="dimension-name">Overall Score:</span>
                                        <span class="dimension-score">{{ inspiration }}/10</span>
                                    </div>
                                    {% if inspiration_dimensions %}
                                        {% for dim, score in inspiration_dimensions.items() %}
                                            {% if dim != 'composite' %}
                                                <div class="dimension-item">
                                                    <span class="dimension-name">{{ dim|title }}:</span>
                                                    <span class="dimension-score">{{ score }}/10</span>
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                        <div class="article-content">
                            <h3>
                                <a href="{{ article['link'] }}" target="_blank">
                                    {% if article.get('topic_icon_path') %}
                                        <span class="title-icon" style="background-image: url('{{ url_for('static', filename=article['topic_icon_path']) }}');"></span>
                                    {% endif %}
                                    {{ article['title'] }}
                                </a>
                            </h3>
                            <p class="summary">{{ article['summary'] | striptags | truncate(100) }}</p>

                            <div class="article-meta">
                                <span class="source-name">{{ article['source_name'] }}</span>
                                {% if article.get('topic_name') %}
                                    <span class="topic-tag {{ article.get('topic_name')|title }}">
                                        {% if article.get('topic_icon_path') %}
                                            <img src="{{ url_for('static', filename=article['topic_icon_path']) }}" alt="topic" class="emoji-icon">
                                        {% endif %}
                                        {{ article.get('topic_name')|title }}
                                    </span>
                                {% endif %}

                                {% if current_user.is_authenticated %}
                                    <form action="{{ url_for('auth.save_article') }}" method="post" style="margin: 0; display: contents;">
                                        <input type="hidden" name="article_link" value="{{ article['link'] }}">
                                        <input type="hidden" name="article_title" value="{{ article['title'] }}">
                                        <input type="hidden" name="topic_name" value="{{ article.get('topic_name', '') }}">
                                        <button type="submit" class="save-button" title="Save Article">
                                            <i class="fas fa-bookmark"></i>
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                            <small class="published">{{ article['published'] | format_datetime }}</small>
                        </div>
                    </article>
                {% endfor %}
            {% else %}
                <p class="no-articles">No articles available right now. Please check back soon!</p>
            {% endif %}
        </main>

        <!-- RIGHT SIDEBAR -->
        <aside class="ad-sidebar">
            <!-- Can be used for future content -->
        </aside>
    </div>

    <footer>
        <p>&copy; {{ now.year }} Project Optimist News. All rights reserved.</p>
        <p>Powered by Optimism</p>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Make source names a little more subtle
        const colors = ['#3498db', '#2ecc71', '#9b59b6', '#34495e', '#16a085', '#27ae60', '#2980b9', '#8e44ad', '#2c3e50'];
        document.querySelectorAll('.source-name').forEach(el => {
            const color = colors[Math.floor(Math.random() * colors.length)];
            el.style.color = color;
            el.style.opacity = '0.8';
        });

        // User dropdown menu
        const userMenuButton = document.getElementById('user-menu-button');
        const userDropdown = document.getElementById('user-dropdown');

        if (userMenuButton && userDropdown) {
            userMenuButton.addEventListener('click', function() {
                userDropdown.classList.toggle('active');
            });

            // Close the dropdown when clicking outside
            document.addEventListener('click', function(event) {
                if (!userMenuButton.contains(event.target) && !userDropdown.contains(event.target)) {
                    userDropdown.classList.remove('active');
                }
            });
        }
    });
    </script>
</body>
</html>
