<!doctype html>
<html lang="en" {% if current_user.is_authenticated and current_user.dark_mode %}class="dark-mode"{% endif %}>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Project Optimist - Your Daily Feed of Positive News</title>
    <meta name="description" content="Project Optimist aggregates positive and uplifting news stories from around the world, filtering out negativity to bring you a brighter perspective.">

    <!-- Fonts & CSS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&family=Montserrat:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" crossorigin="anonymous">
</head>

<body>
    <!-- Sticky Header -->
    <header>
        <div class="brand-section">
            <h1><a href="/">Project Optimist</a></h1>
            <p class="tagline">Your daily dose of positivity</p>
        </div>

        <div class="user-menu">
            {% if current_user.is_authenticated %}
                <div class="user-button" id="user-menu-button">
                    <i class="fas fa-user-circle"></i>
                    <span>{{ current_user.username }}</span>
                </div>
                <div class="user-dropdown" id="user-dropdown">
                    <a href="{{ url_for('auth.profile') }}"><i class="fas fa-cog"></i> Profile Settings</a>
                    <a href="{{ url_for('auth.saved_articles') }}"><i class="fas fa-bookmark"></i> Saved Articles</a>
                    <div class="divider"></div>
                    <a href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt"></i> Log Out</a>
                </div>
            {% else %}
                <div class="auth-buttons">
                    <a href="{{ url_for('auth.login') }}" class="user-button">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Log In</span>
                    </a>
                    <a href="{{ url_for('auth.signup') }}" class="user-button">
                        <i class="fas fa-user-plus"></i>
                        <span>Sign Up</span>
                    </a>
                </div>
            {% endif %}
        </div>
    </header>

    <!-- Main Layout Container -->
    <div class="layout-container">
        <!-- Left Sidebar -->
        <aside class="filter-sidebar">
            <div class="sidebar-section">
                <h3>CATEGORIES</h3>
                <ul class="filter-list">
                  <li>
    <a href="/" class="filter-item all-news-filter {% if not selected_topic %}active{% endif %}">
        <img src="{{ url_for('static', filename='/openmoji/color/svg/1F4F0.svg') }}" alt="icon" class="filter-icon">
        All News
    </a>
</li>

                    <!-- Travel and Teens first as requested -->
                    {% set priority_topics = ['travel', 'teens'] %}
                    {% for p_topic in priority_topics %}
                        {% if p_topic in topics %}
                            <li>
                                <a href="/?topic={{ p_topic }}" class="filter-item {% if selected_topic == p_topic %}active{% endif %}">
                                    {% if topic_icons.get(p_topic) %}
                                        <img src="{{ url_for('static', filename=topic_icons.get(p_topic)) }}" alt="icon" class="filter-icon">
                                    {% endif %}
                                    {{ p_topic|title }}
                                </a>
                            </li>
                        {% endif %}
                    {% endfor %}

                    <!-- Other topics -->
                    {% for topic in topics %}
    {% if topic not in priority_topics %}
        <li>
            <a href="/?topic={{ topic }}" class="filter-item {% if selected_topic == topic %}active{% endif %}">
                {% if topic|lower == 'business' %}
                    <!-- Force display of business icon -->
                    <img src="{{ url_for('static', filename='/openmoji/color/svg/1F4BC.svg') }}" alt="icon" class="filter-icon">
                {% elif topic_icons.get(topic) %}
                    <img src="{{ url_for('static', filename=topic_icons.get(topic)) }}" alt="icon" class="filter-icon">
                {% endif %}
                {{ topic|title }}
            </a>
        </li>
    {% endif %}
{% endfor %}
                </ul>
            </div>

            <!-- Last updated information -->
            <div class="sidebar-section">
                <div class="last-updated">
                    <i class="fas fa-sync-alt"></i>
                    <span>Last updated: {{ last_updated|format_datetime if last_updated else 'Just now' }}</span>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>ABOUT</h3>
                <p class="sidebar-info">Project Optimist brings you positivity from around the world, using AI to find and rank the most inspiring stories.</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            {% if articles %}
                <!-- Sort options -->
                <div class="sort-options">
      <a href="/?sort=hot{% if selected_topic %}&topic={{ selected_topic }}{% endif %}"
         class="sort-option {% if sort == 'hot' or not sort %}active{% endif %}">
          <i class="fas fa-fire"></i> Hot
      </a>
      <a href="/?sort=new{% if selected_topic %}&topic={{ selected_topic }}{% endif %}"
         class="sort-option {% if sort == 'new' %}active{% endif %}">
          <i class="fas fa-clock"></i> New
      </a>
  </div>

                <!-- Top Stories Section -->
                <div class="section-header">
                    <i class="fas fa-trophy"></i> TOP STORIES
                </div>

                {% for article in articles %}
                    {% set is_truly_inspiring = article.get('is_inspirational', False) %}
                    <div class="post">
                        <!-- Vote sidebar -->


                        <div class="post-content">
                            <div class="post-header">
                                <div class="post-metadata">
                                    <a href="/?topic={{ article.get('topic_name', 'general') }}" class="post-topic">
                                        {% if article.get('topic_icon_path') %}
                                            <img src="{{ url_for('static', filename=article['topic_icon_path']) }}" alt="topic" class="topic-icon">
                                        {% endif %}
                                        {{ article.get('topic_name', 'general')|title }}
                                    </a>
                                    <span class="post-source">{{ article.get('source_name', '') }}</span>
                                    <span class="post-time">{{ article['published'] | format_datetime }}</span>

                                    {% if is_truly_inspiring %}
                                        <span class="inspiring-tag">
                                            <i class="fas fa-star"></i> Inspiring
                                        </span>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="post-body">
                                {% if article.get('image_url') %}
                                    <div class="post-image">
                                        <img src="{{ article['image_url'] }}" alt="Article image">
                                    </div>
                                {% endif %}

                                <div class="post-text">
                                    <h3 class="post-title">
                                        <a href="{{ article['link'] }}" target="_blank">{{ article['title'] }}</a>
                                    </h3>
                                    <p class="post-summary">
                                        {{ article['summary'] | striptags | truncate(180) }}
                                    </p>
                                </div>
                            </div>

                            <div class="post-actions">
                                <div class="action-buttons">
                                    <button class="action-button share-btn" data-url="{{ article['link'] }}" data-title="{{ article['title'] }}">
                                        <i class="fas fa-share-alt"></i> Share
                                    </button>

                                    {% if current_user.is_authenticated %}
                                        <form action="{{ url_for('auth.save_article') }}" method="post" style="display: inline;">
                                            <input type="hidden" name="article_link" value="{{ article['link'] }}">
                                            <input type="hidden" name="article_title" value="{{ article['title'] }}">
                                            <input type="hidden" name="topic_name" value="{{ article.get('topic_name', '') }}">
                                            <button type="submit" class="action-button save-btn">
                                                <i class="far fa-bookmark"></i> Save
                                            </button>
                                        </form>
                                    {% else %}
                                        <a href="{{ url_for('auth.login') }}" class="action-button save-btn">
                                            <i class="far fa-bookmark"></i> Save
                                        </a>
                                    {% endif %}

                                    <a href="{{ article['link'] }}" target="_blank" class="action-button read-btn">
                                        <i class="fas fa-book-open"></i> Read Full Article
                                    </a>
                                </div>

                                <div class="share-dropdown">
                                    <a href="https://twitter.com/intent/tweet?url={{ article['link'] | urlencode }}&text={{ article['title'] | urlencode }}" target="_blank" class="share-option">
                                        <i class="fab fa-twitter"></i> Twitter
                                    </a>
                                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ article['link'] | urlencode }}" target="_blank" class="share-option">
                                        <i class="fab fa-facebook-f"></i> Facebook
                                    </a>
                                    <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ article['link'] | urlencode }}&title={{ article['title'] | urlencode }}" target="_blank" class="share-option">
                                        <i class="fab fa-linkedin-in"></i> LinkedIn
                                    </a>
                                    <a href="mailto:?subject={{ article['title'] | urlencode }}&body={{ article['link'] | urlencode }}" class="share-option">
                                        <i class="fas fa-envelope"></i> Email
                                    </a>
                                    <a href="#" class="share-option copy-link" data-url="{{ article['link'] }}">
                                        <i class="fas fa-link"></i> Copy Link
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="no-articles">
                    <i class="fas fa-newspaper"></i>
                    <h3>No articles available right now</h3>
                    <p>Please check back soon or try refreshing the page.</p>
                </div>
            {% endif %}
        </main>

        <!-- Right Sidebar -->
        <aside class="ad-sidebar">
            <div class="sidebar-section">
                <h3>JOIN US</h3>
                <p class="sidebar-info">Join our community of positive news enthusiasts and get daily updates on the best inspirational stories.</p>
                {% if not current_user.is_authenticated %}
                <div class="join-button-container">
                    <a href="{{ url_for('auth.signup') }}" class="join-button">
                        <i class="fas fa-user-plus"></i>
                        Create Account
                    </a>
                </div>
                {% endif %}
            </div>

            <div class="sidebar-section">
                <h3>TOP TOPICS</h3>
                <div class="topic-tags-container">
                    {% for topic in topics[:6] %}
                        <a href="/?topic={{ topic }}" class="topic-tag {{ topic|title }}">
                            {% if topic_icons.get(topic) %}
                                <img src="{{ url_for('static', filename=topic_icons.get(topic)) }}" alt="{{ topic }}" class="emoji-icon">
                            {% endif %}
                            {{ topic|title }}
                        </a>
                    {% endfor %}
                </div>
            </div>
        </aside>
    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; {{ now.year }} Project Optimist. All rights reserved.</p>
        <p>Powered by Good Vibes</p>
    </footer>

    <!-- Toast notification -->
    <div class="toast" id="share-toast">
        <i class="fas fa-check-circle"></i>
        <span>Link copied to clipboard!</span>
    </div>

    <div class="toast" id="save-toast">
        <i class="fas fa-check-circle"></i>
        <span>Article saved successfully!</span>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // User dropdown menu
            const userMenuButton = document.getElementById('user-menu-button');
            const userDropdown = document.getElementById('user-dropdown');

            if (userMenuButton && userDropdown) {
                userMenuButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    userDropdown.classList.toggle('active');
                });

                document.addEventListener('click', function(e) {
                    if (!userMenuButton.contains(e.target) && !userDropdown.contains(e.target)) {
                        userDropdown.classList.remove('active');
                    }
                });
            }



            // Share button functionality
            document.querySelectorAll('.share-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const dropdown = this.closest('.post-actions').querySelector('.share-dropdown');
                    dropdown.classList.toggle('active');

                    // Close other open dropdowns
                    document.querySelectorAll('.share-dropdown.active').forEach(openDropdown => {
                        if (openDropdown !== dropdown) {
                            openDropdown.classList.remove('active');
                        }
                    });
                });
            });

            // Close share dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.share-btn') && !e.target.closest('.share-dropdown')) {
                    document.querySelectorAll('.share-dropdown.active').forEach(dropdown => {
                        dropdown.classList.remove('active');
                    });
                }
            });

            // Copy link functionality
            document.querySelectorAll('.copy-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const url = this.getAttribute('data-url');

                    // Copy to clipboard
                    const tempInput = document.createElement('input');
                    document.body.appendChild(tempInput);
                    tempInput.value = url;
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);

                    // Show toast
                    const shareToast = document.getElementById('share-toast');
                    if (shareToast) {
                        shareToast.classList.add('active');
                        setTimeout(() => {
                            shareToast.classList.remove('active');
                        }, 3000);
                    }

                    // Close dropdown
                    this.closest('.share-dropdown').classList.remove('active');
                });
            });

            // Show toast when save button is clicked
            document.querySelectorAll('.save-btn').forEach(btn => {
                if (btn.tagName.toLowerCase() === 'button') {
                    btn.addEventListener('click', function(e) {
                        const saveToast = document.getElementById('save-toast');
                        if (saveToast) {
                            saveToast.classList.add('active');
                            setTimeout(() => {
                                saveToast.classList.remove('active');
                            }, 3000);
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>
